# Original dkms-virtualbox_bin: Jason Melton <jason.melton@gmail.com>
# Maintainer: Massimiliano Torromeo <massimiliano.torromeo@gmail.com>

pkgname=dkms-virtualbox
pkgver=4.0.12
_build=72916

pkgrel=3
pkgdesc='DKMS for Oracle VM VirtualBox'
arch=('i686' 'x86_64')
url='http://virtualbox.org'
license=('GPL2')
depends=('dkms' 'virtualbox')
conflicts=('dkms-virtualbox_bin')
install='dkms-virtualbox.install'

_arch='x86'
[ "${CARCH}" = 'x86_64' ] && _arch='amd64'
source=("VirtualBox-${pkgver}-${_build}-Linux_${_arch}.run::http://download.virtualbox.org/virtualbox/${pkgver}/VirtualBox-${pkgver}-${_build}-Linux_${_arch}.run")

md5sums=('d020868f3d255a913eb9c9dbee2b7ff8')
[ "${CARCH}" = 'i686' ] && md5sums[0]='c072af8d97d8bb56fce1e0332eaf94b6'

build() {
	# Check and unpack the run package via sh(1)
	sh "VirtualBox-${pkgver}-${_build}-Linux_${_arch}.run" --check
	echo yes | sh "VirtualBox-${pkgver}-${_build}-Linux_${_arch}.run" --target "${srcdir}" --nox11 --noexec &> /dev/null

	# Unpack src
	install -d -m0755 "$pkgdir/usr"
	cd "$pkgdir/usr"
	tar -xjf "$srcdir/VirtualBox.tar.bz2" src
	mv src/vboxhost src/vboxhost-$pkgver
}


